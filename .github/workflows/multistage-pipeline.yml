name: Simple Multistage Pipeline

on:
  push:
    branches:
      - main
      - staging
      - develop

jobs:
  # BUILD STAGE - RUNS FIRST FOR ALL BRANCHES
  build:
    name: Build Application
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build
        run: |
          echo "üî® Building application..."
          echo "Timestamp: $(date)"
          echo "Files compiled successfully"

  # DEVELOPMENT STAGE - DEPENDS ON BUILD (develop branch)
  deploy-dev:
    name: Deploy to Dev
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/develop'
    steps:
      - uses: actions/checkout@v4
      - name: Deploy to Development
        run: |
          echo "‚úÖ Deploying to Development..."
          echo "Branch: develop"
          echo "Build Status: ${{ needs.build.result }}"
          echo "Timestamp: $(date)"

  # STAGING STAGE - DEPENDS ON BUILD (staging branch)
  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/staging'
    steps:
      - uses: actions/checkout@v4
      - name: Run Tests
        run: |
          echo "üß™ Running tests on staging..."
          echo "Build Status: ${{ needs.build.result }}"
          echo "Checking file integrity..."
      - name: Deploy to Staging
        run: |
          echo "‚úÖ Deploying to Staging..."
          echo "Branch: staging"
          echo "Timestamp: $(date)"

  # PRODUCTION STAGE - DEPENDS ON BUILD (main branch)
  deploy-prod:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    environment:
      name: production
    steps:
      - uses: actions/checkout@v4
      - name: Pre-deploy Checks
        run: |
          echo "üîç Running pre-deployment checks..."
          echo "Build Status: ${{ needs.build.result }}"
          echo "Verifying all files..."
      - name: Deploy to Production
        run: |
          echo "‚úÖ Deploying to Production..."
          echo "Branch: main"
          echo "Timestamp: $(date)"
          echo "Manual approval required for production"
          echo "Alert: This is PRODUCTION environment"
